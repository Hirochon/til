## shappar-今日も楽しくテストをかき続ける日々 (2020/3/21)

### 今日やったこと
1. まず投票機能POSTリクエスト正常時のテストを作成！(※流れがめんどかったw)
    - 以下の方法でやらないと僕の作ったバリデーションに引っかかります！！w
    1. ユーザーアカウントを２つ作る
    2. 作成したユーザー１でログイン(ヘッダーにトークンを発行/のせる)
    3. 2でログインしたたユーザーを使って投稿する
    4. 作成したユーザー2でログイン(ヘッダーのトークンを新たに発行/のせて上書き)
    5. 4でログインしたユーザーで投票を行う
2. 昨日にCircleCIにてENVをPythonファイルで呼び出せることに気付いたので仕様を一斉変更!
    - 理由は本番環境/ローカル環境にテスト環境をできるだけ近づけたかった
    - テスト用の設定ファイルも一新！
    - CircleCIに設定している環境変数も色々追加！
3. 投票機能の異常系のテストを作成！
    - ヘッダーにトークンがのっていない時
    - 投稿に投票したが投稿IDが存在しない時
    - 他人の投稿に投票したが選択肢が存在しない時
    - ※↑コチラの選択肢が存在しないに関しては作成しましたw
4. 以上の投票機能に関してのテストを実装 → [PullRequest #154](https://github.com/Hirochon/Shappar/pull/154)
5. 投稿削除機能も実装しました！ → [PullRequest #156](https://github.com/Hirochon/Shappar/pull/156)
    - 端折りすぎw
6. 投票情報更新機能のテストについて〜
    - 無理やりテスト実装って感じで、今のコード嫌いw
    - 何に時間かかったかと言うと、`datetime`ですよ。ややこしくない？w
    - あんまり良い情報が乗ってるサイトが少なかった。
    - でもやっぱオライリー書籍は神だと思いました。
    ```python:test.py
    post_created_at = str(post.created_at)
    hours = timedelta(hours=9)
    utc_created_at = datetime.strptime(post_created_at, '%Y-%m-%d %H:%M:%S.%f%z')
    created_at = utc_created_at + hours
    created_at.strftime('%Y-%m-%dT%H:%M:%S.%fZ')
    ```
    - こんな感じでテストに合格するために変形させてた。はぁ。しんどw
7. もう疲れすぎて文章かく気力ないですw
    - 色々工夫したとこあったけど、行多すぎていいやw
    - つかれたあああ
8. 最終的なプルリクはこれやあああああああああああああ！！！　→　[Pull Request #156](https://github.com/Hirochon/Shappar/pull/156)